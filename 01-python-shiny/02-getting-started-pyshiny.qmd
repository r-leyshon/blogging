---
title: "Let's Build a Basic Python Shiny App."
author: "Rich Leyshon."
date: today
date-modified: last-modified
toc: false # off to avoid overlapping larger iframes in this article
execute: 
  eval: false
format:
  html:
    code-fold: true
    code-summary: "Show the code"
    mermaid:
      theme: default
---
## Getting to grips with Python Shiny.

<figure class=center>
  <img class=shaded_box src="https://c0.wallpaperflare.com/preview/564/703/665/school-coding-software-development-education.jpg" alt="Woman Instructing On Laptop." width=300px>
  <figcaption>Source: <https://www.wallpaperflare.com/>. Creative Commons License.
  </figcaption>
</figure>

This tutorial is intended for those who are already familiar with Python, but
may be less familiar with dashboarding and Shiny in Python. It may also be of
interest to those who are well-versed in RShiny and would like to see how it has
been implemented in Python. 

This is a light-weight, introductory Python Shiny tutorial. No
installation of software is required, other than a web-browser (which you must
already have) and a willingness to experiment. We will use the shinylive service
to display the application that we write and steadily add to a basic app,
discussing some of the concepts as we go. Finally, let's regroup and  reflect on
some coping techniques for when you begin writing your own Python Shiny apps.

This tutorial will not attempt to reproduce any of [Posit's documentation](https://shiny.posit.co/py/), which is rather excellent so please check that out. Also, if you would prefer a
conceptual treatment of Python Shiny, please see my blog on
[The Current Stateof Python Shiny](01-state-of-pyshiny.html).

::: {.callout-note appearance="simple"}
### How to...
Feel free to tinker with the code in the following example apps and then press
play in the top-right hand corner of the console interface. Don't worry - you
won't break anything important. To reset the code, simply refresh your web page.

If the app doesn't launch, you'll see some spinning grey hexagons that never go
away <i class="fa-regular fa-face-sad-tear fa-bounce fa-lg"></i>. This is likely
to be a problem with permissions in your browser. But you can click on the
collapsible code block below the app windows and copy the code to an app.py file
on your computer. If you have python and python shiny installed, you should be
good to go.
:::


### Hello Python Shiny! {{< fa brands python >}}

Below is a really minimal app that doesn't do very much at all. The python code
is presented on the left. The interactive app is presented on the right. You can
type into the app's text field, and that's about it for now. 

<div class=centerdiv>
  <iframe src="https://shinylive.io/py/editor/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMAYgEYACASRlWICcyGZiATAVwA2cAM4MyxBgAs4g1A35iARvwCWg3g2L92DNKgA6EAGbtiMBiKmqI2BqtYcuavAwCC6I0ZoA9VPzIyGwBzcWsIYLEoJWIANzgwhP1uOCgIMTIZO0I0hiUEqyh2OE18sgB3OEoGbG1dNT0ITRE4dnj2L2h0AH0GgF4FVSwoYLhu40E1XgAKIwYGGgAmPUFBLWNEhlk4eHIxWv4GctUrcUkrYnKauoUW3QuhTWDJY8ybTbU5+cGMG38yboUAAeZFmEG+EPsvD6BkgsDGlDI7GwsLwX0hDEE0VkMLAAAVhFAWltyK1rjoGNB4Kj0ZDUFjCHApMQNK1cQBNG5UhIyYqw2kQgCURmFECMvDgGzu7WmfwCrm0ZH+rhaIhEqlIgsQXxoAGYwid7GJyryEgddMlBMRgqpCJZmY8GM8MAwAMqSYxFVwQYhcGD8QhSDDB2nFMg6cEAOVIcC+3gYADEbFBVnYALQG5SqLioKCEADWI1ECnkNwaaWarXaLtd-FQZIcbE4aS4Gez3EUZHj+Up8M0AAN9P2MEZkgMPKhpvpeqoVVXWoKwABfAC6QA" title="Getting Started with a basic Python Shiny App."></iframe>
</div>

```{python}
#1 Import modules to help us build our app
from shiny import ui, App

#^putting things above the app means they can be shared between your ui and server

app_ui = ui.page_fluid(
  #2 all of the elements you wish to show your user should go within the ui
    ui.input_text(
        id="name_entry",
        label="Please enter your name",
        placeholder="Your name here"
        )
)

def server(input, output, session):
  #3 this is where your app logic should go. So far, not much...
    return None
  
# Finally - this bit packages up our ui and server. Super important - it must
# be named `app`.
```



You'll see that the code defines an `app_ui` object, which is a Shiny ui
instance. Within that `ui.page_fluid()` function, we can specify all the
elements of the app that we would like to present to our users.

::: {.callout-note appearance="simple"}
### On Users...
There are only two industries that call their customers “users”: illegal drugs and software
– Edward Tufte
:::

So far, only one simple ui element has been defined. The humble text input `ui.input_text()` which allows our users to place their own text into a text field.

Notice that in Python, all the inputs begin with `input...`. There's `ui.input_text()` as we've seen, but there's lots more. `ui.input_date()`, `ui.input_file()` and `ui.input_slider` to name a few. This consistent syntax approach is a subtle improvement over RShiny and makes it so much easier to work with the vast array of widgets without having to remember them all. If you're working in a modern editor such as [Visual Studio Code](https://code.visualstudio.com/), simply typing `ui.input` will remind you of all the options available to you. For those not working in a nice GUI like VSCode, a [Shiny cheatsheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/shiny.pdf) may be useful, though note that at the time of writing I could only find R-flavoured ones...

All ui input elements start with the same 2 arguments, `id` and `label`:

* `id`: The internal name of the input. What does that mean? Call it what you like. Whatever you choose, be aware that when you want to use the values from the text input to do something in the server, it's this name that you will need to reference.
* `label`: A short piece of text that prompts your user to do something. This will be displayed in your ui above the input element. 

### Doing Something With the Shiny Server.

Unfortunately, so far our app doesn't actually do much. Typing into the empty text field yields no result. That's because right now, our `server` function simply returns `None`. Let's resolve this.

<div class=centerdiv>
  <iframe src="https://shinylive.io/py/editor/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMAYgEYACAV1QBMoKGyALOBgSxipiAJzIMAzmQ5x45LsQERCAGyas+AAxGUNIzQxjFWTFXAA6EAGYjiMSd34RsAoaPFN+eBgEF03nQg9S0s0VAB9TwYAXmZ+LCgAczhwqzV+VgAKSwZcuIwnVCYycIoADzJsiDyagVZo80hYFMoyEWxGvBza3JUoACM4FQawAAUzKAk+VrgRBmxiJjnoeE7untQ+wjhuYhU9EYBNReXmhl4dRvXagEou6ryaACYGAEllNQ0GKDiGRbIiuIhrJWhgGAAVRwSBgAd34KhUDmIMK4vAYhCgKkIpg4-FIEmuNEMUC+TlRfCmIgAbrMGP0oIQANYKcnMSkYa6eDD-QGlOAVcI0kT0siCbJgRI6OCiiCJRp3Sw3EJBOBWSSzIWZQrFbw8nXqiQSPEQG6IQkAZgYAFU2DJWZShbD+DxvgwrExlKLSKiOOcoEEzNCeHxyuIdBJhBAphyHrkAAJ68REphTVmJhgaEgiDiiFkwKAiZk8fjQ92e43XOOBPQYUMMImYiSKCBwOCsFmUCRLPgwvgpkNorM6Qhh3S0zOiHMia4aNWS1syxKZU3XGpXMBXWO1SElt0ekfGp0IrhQRkDvjp4hq4P5bUlUPLhjAuRke49XJWUT58Q3qQiJyJEorrCCozoUjMyh8P67afiI34COIkzfNUAAS4IALIADKrnk6awayURkIoEi7DCMbvgw66bhROhkEs1RWI0KH8AwIB3hgKwtOQ7TLgAvt4vZYnYIaKKM2A8N6ADKjjOByG4QKE6AxL46CZGEkReOq1KzDcYC8QAukAA" title="Basic Server Functionality in a Python Shiny App."></iframe>
</div>

```{python}
#1 update the import statement to include `render` module
from shiny import ui, App, render

app_ui = ui.page_fluid(
    ui.input_text(
        id="name_entry",
        label="Please enter your name",
        placeholder="Your name here"
        ),
    #2 Include a ui output element. This will show the calculations
    # made in the server back to the user.
    ui.output_text_verbatim("greeting"),
)

def server(input, output, session):
    #3 Update the server with a function that handles the text response.
    @output # use the output decorator to mark this function
    @render.text # also need to ensure we use the correct render decorator
    def greeting():
        """
        This function will take the output of the ui.input_text() element,
        format the string in a polite sentence and format it as an HTML
        output for the ui to show.
        """
        return f"Hi {input.name_entry()}, welcome to Python Shiny."

app = App(app_ui, server)

```


There's quite a lot going on in the above code chunk. Let's start with the
decorators `@output` & `@render.text`:

* `@output`: Any function marked with this decorator will have its returned
value made available to the user interface. Notice that in the line `ui.output_text_verbatim("greeting")` we are able to call on the values of the
server's `greeting()` function that we marked as an `@output`.
* `@render.text`: This tells Shiny what type of output to handle. Is it text, a chart (`@render.plot`) or something more fancy, like dynamically rendered ui (`@render.ui`). These output types all have their corresponding output functions to use in the ui. Here we called `ui.output_text_verbatim()`.
* Calling the wrong ui-side function may not result in an error, but can have unexpected results, such as your text disappearing from your app. Keep an eye out for that if things aren't working - are you using the correct combination of `render` in the server with `output_...` in the ui?

Did you notice anything off-putting about the above code? Yes, too many comments but please indulge me. Functions in the server and ui are passing values back and forth. That can be a bit overwhelming to get your head around when you're new to what's known as 'event-driven programming'. All that means is that the program needs to respond to some action taken by the user. The syntax in which you reference the functions is a bit inconsistent to my mind. Let's take a closer look:

If I mark some function `make_plot()` in the server as an `@output` and then wish to call on its value within the ui, I need to use `ui.output_plot("make_plot")`. Notice the lack of brackets following the function name `"make_plot"`. Getting this wrong will result in a `ValueError`. Forgetting to wrap the function reference in a string will result in a `NameError`.

Now in the other direction, perhaps we have a numeric input passing integer values from the user to the server. We'll give the slider widget the `id="int_slider"`. Now when we want to use the value of this slider on the server-side, we use a different syntax: 

```
def print_selection():
    n = int_slider()
    return f"You chose {n}!"
```

Notice this time, we include brackets after our call to the widget id: `n = int_slider()`. Weird, right? Getting this wrong may result in unexpected behaviours. Keep an eye out for this. Also, wrapping server id references in speech marks results in unexpected behaviours, but not necessarily errors.

If I haven't lost you yet, well done! Debugging applications can be a very frustrating process - part intuition earned from hours of Shiny debugging, part [Stack Overflow](https://stackoverflow.com/) and part coping mechanisms. I'll cover some of those in the Tips section.

### Ready, Steady, Go!

One final adjustment to this app. When you're typing a name into the text input field, there's a bit of a race going on. Can you type faster than the server can render the text? This may not be what you want. In fact, you may require a bunch of selections to be made prior to calculating anything in the server. We can use methods to interrupt and isolate elements of the server. In effect, we can tell any of our server functions to hang fire until a certain condition is met. In this example, we'll try out perhaps the simplest way of achieving this, enter the `ui.input_action_button()`.

<div class=centerdiv>
  <iframe src="https://shinylive.io/py/editor/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMAYgEYACASRlWICcyGyALOB9nCiEyASwBu-GMQAmAVwA2-AGbtiMBgGUeoiNgA6EVeoYBnHXoajWHLnNF4BlGXHaOAgukeDhYyYcM0VAB9ewYAXgZ7LCgAczhg5QV7GQAKQwZMqNEMXVQ5MmCKAA8ydIgsyqsZcP1IWATKMnYDfAyqzIUoACM4BVqwAAUlKFN+JtcGbGI5dgZoeDq8do7ULsI4HmIFF3YBgE0ZuYX+PkE6laqASmWKrJoAJgYoGRlnit9RUgZugrJv-7cPjZRwwOSEHgMBSiADW-AA7vwZKI3vDRLwgfwSlw8gVLtFcYVPqRgr8yP8IKkUQNYsRSX9SEsoT0+gMAMLQwgw7jEARyCAYQV1G6XGjPV5mdT8cSiUxyKAKMxwVBQdhQMQA3m8LFwUoMGZkfJkfE5MhxUwYbrsVIiu6ZaJm2IWq0224mjAGo1FXWFSTsbrq6zpMCxQRwMQQWLC25XAIQFzKJXsP1UiBGxyegqOMamUxfCBXRCigDM4reUA+r3R+YVDBgqu5vQUxHhmP12vYpkuAAFM8a7Qxu4J464MNiez4RBI4Bg4JJyKmjRhafTyaRYwOEwxQ3Bw7pYjaiwPKoIyLMKso6gAJUQMECEjAnYJNFo2gC+jkRChI8B5DEG2C8N82i6NgGAXBAhhigAKjophWPBUBaBYYGeKg+rdAAVnAIgYMwXBgqYXC9PMDRvAABkE5HgdA6ARAwaGpEEoQOEmfobmAb4ALpAA" title="Control the Reactive Flow With the Action Button."></iframe>
</div>

```{python}
#1 Import the reactive module from Shiny
from shiny import ui, render, App, reactive

app_ui = ui.page_fluid(
    ui.input_text(
        id="name_entry",
        label="Please enter your name",
        placeholder="Your name here"
        ),
    #2 add an action button to the ui, much like we did with the text input
    ui.input_action_button(id="go_button", label="Click to run..."),
    # add some visual separation to the text output
    ui.tags.br(),
    ui.tags.br(),

    ui.output_text_verbatim("greeting"),
)

def server(input, output, session):
    #3 add an additional mark below the others
    @output
    @render.text
    @reactive.event(input.go_button)
    def greeting():
        return f"Hi {input.name_entry()}, welcome to Python Shiny."

# This is a Shiny.App object. It must be named `app`.
app = App(app_ui, server)

```


You should now see that an input button has appeared and the sentence won't get printed out until you press it.

Also notice that the inconsistency in how to refer to functions on the other side of the ui:server divide rears its head once more. All in the server, when we want to use the values returned by the text input, we use the syntax `input.name_entry()`. When we want to use the action button in the reactive decorator, we have to use `input.go_button` - no parenthesis! The docs describe this as when you need to access the returned value versus when you need to call the function. This does make sense but can introduce some cognitive conflict while you are working with Shiny. I hope by version 1.0 the development team can find a way to simplify things.

I also included some visual separation between elements in the ui by using `ui.tags.br()`. If you know a little HTML, you may get excited at that. You can access all the typical HTML tags in this way:


<div class=centerdiv>
  <iframe src="https://shinylive.io/py/editor/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMAMwCdiYACAZwAsBLCbJjmVYnTJMArhzxMAgugl1KAEzh0AOhFVpUAfTFMAvKI5YoAcziaaAGzHyAFKqYODGMiZYY2ARjthJTC3AA3OAsmDyY2OCh5LmNlMABKPHtHMWdXdwAmb19-IJCM8MjoiFiEpIhHJxdjNwAjOhtE5IdU6rdUbwBlRjgmCgAPYTiJVvSWMgYS7y4mWuILeQwluPj41VU1tQhFGlYlIIauVBEyCWIT49O9lhYOUnjEZqY5MhE6CoA5Ujh16HQ9KToGwabTiPZ0A7xMAAXwAukA" title="Displaying DOM elements with Shiny Tags."></iframe>
</div>


```{python}
from shiny import ui, App, render

app_ui = ui.page_fluid(
    ui.tags.h1("A level 1 heading"),
    ui.tags.h2("A level 2 heading"),
    ui.tags.br(),
    ui.tags.p("Some text ", ui.tags.strong("in bold..."))

)

def server(input, output, session):
    return None

app = App(app_ui, server)

```

So there you have it. A very basic application that can be used to print out some simple messages to your user. This is of course a trivial app in order to keep things basic for the purposes of this blog. If you'd like to investigate what's possible with Shiny, I'd suggest taking a peek through the [Posit docs examples](https://shinylive.io/py/examples/) and the [Python Shiny gallery](https://shiny.posit.co/py/gallery/). In the next section I'll go over some tips that may help with common pitfalls I've encountered while working in Shiny.

## Tips.

### Shiny for Python VSCode Extension.

The [Shiny for Python](https://marketplace.visualstudio.com/items?itemName=Posit.shiny-python) extension is a convenient way to launch Python Shiny apps. It adds a 'Run Shiny App' button to the VS Code interface, allowing for options to serve the app locally within a dedicated VS Code viewer window, or alternatively launch the app directly within your default web browser.

In order to run your application with this extension, you must ensure your app file is saved as `app.py`, otherwise the run button will not recognise that the currently selected document is a Shiny app.

### Header Accessibility Adjustment.

A big shoutout to Utah State University for making their fantastic suite of web accessibility-checking tools open source. These tools make checking the accessibility of your web products much easier. Simply visit the [Web Accessibility Evaluation Tool (WAVE)](https://wave.webaim.org/) and enter a url under "Web page address:" and press return. The site will launch a helpful overlay on top of your specified url, highlighting accessibility alerts, warnings and features. There is also a sidebar helpfully explaining why the various alerts are important and what can be done to resolve them.

Unless you have managed to host a Shiny application on a service such as shinyapps.io, unfortunately you won't have a url to pass to WAVE. Working locally on your machine, your locally hosted app interface will launch with a url like: http://localhost:... There is another way to use WAVE to check localhost sites. Using the [WAVE browser extensions](https://wave.webaim.org/extension/) will allow you to launch the WAVE tool within any of your browser windows. This would allow you to run these checks locally on your machine while also ensuring that your app looks good on Chrome, Firefox or Edge. When checking basic Python Shiny apps for accessibility, one of the common accessibility errors you will encounter will be:

::: {.callout-caution}

### Language missing or invalid!
The language of the document is not identified or a lang attribute value is invalid.

:::

This means a screen reader may not detect the language of the website content and may not work properly. The ideal scenario would be that Shiny would ask you to specify the language of the application that you are working in at the point where you create the application. It's a straightforward fix though. We can include some tags at the top of our ui that will update the web page content with the required information:

<div class=centerdiv>
  <iframe src="https://shinylive.io/py/editor/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMAMwCdiYACAZwAsBLCbJjmVYnTJMArhzxM6lACZw6EgILoJUqITIcAbnAA6EPWlQB9MUwC8ojligBzOEZoAbMdIAUepp6YBiJgunSTFBMbHBQsnRBEIEsqHCEHDQ8ZKFMjlAQNiK2cFGBGmSOcBgeXmIYZLYsGKHhcq7llTbVbGQwjq7pmWY6YJS9AJQSjVUVHIVw7mAKTABKYY6OPABCUCwchH7og0N6pZ7lXKgiZEYUAB5k7hBet7zSPZCw9pRkdNi9ePt36QBGcI5HgAFIprXKvORMbDEESRaDwT7fW6odKEOBsYiOCKPACaMLhzxCcl0YCRXl2NzKViOJyMag0pCMvxOZFIrg4D16NmITJZpE+aSg-0BvQAwo4NgBrJisyQiCAYRWDL6Ug5WJrVX50VwU24jZoYLU6lXfcowsjHU4XU7aOi-KAaGBTGxSOAaTLKvQDPbROA0VhyW3siCWiTm0MBljrUgDRDfAAC4ZOCakvroFTglxTYXUWmKcG05GDlow3N5ZFZEG9qqYsn9Lrgbq4Nh1cZrtykZFhNxovQAEhwmCAaWQMPCXuR3jqAL4SADuAJI8BlxCYQOwKVITAAypxuCVSfpoOhzFtUK5DCZxAG6Lbq2BpwBdIA" title="Add an Accessible Header to a Shiny App."></iframe>
</div>

```{python}
from shiny import ui, render, App, reactive

app_ui = ui.page_fluid(
    # Add a header and specify the language and title.
    ui.tags.header(ui.tags.html(lang="en"), ui.tags.title("A Really Basic App")),

    ui.input_text(
        id="name_entry",
        label="Please enter your name",
        placeholder="Your name here"
        ),
    ui.input_action_button(id="go_button", label="Click to run..."),
    ui.tags.br(),
    ui.tags.br(),

    ui.output_text_verbatim("greeting"),
)

def server(input, output, session):
    @output
    @render.text
    @reactive.event(input.go_button)
    def greeting():
        return f"Hi {input.name_entry()}, welcome to Python Shiny."

app = App(app_ui, server)


```


### Missing Commas.

One of the more frustrating aspects of debugging Shiny applications, particularly as the application grows, is that a single misplaced comma can completely break your application. The thing to look out for here is when you run your app and you get the unexpected `SyntaxError: invalid syntax` error. I recall this being a real headache when I was learning RShiny, so much so that I would leave a little comment after each comma reminding me of which element of the code was being closed within the preceding bracket.

The Python errors are really helpful. They not only point to a problem with the syntax, but they identify the line number in the app where the first instance of this issue was encountered. 

### Debugging Errors.

At times it can be unclear why errors are being raised and it becomes important to investigate intermediate values that are being calculated in the server. Your usual python debugging tools may not work with Python Shiny. Shiny is event-driven and the reactive flow and order of the object definitions in your scripts are treated a bit differently. Without a tool like R's `Reactlog` package, this is currently quite tricky to do in Python. The main coping mechanism available at the moment is to include some text outputs in the ui, paired with render text functions in the server. You can go ahead and use these elements to helpfully print out intermediate values such as DataFrame column names, data types etc and then comment them out when they're no longer needed. Examining these intermediate values from within your ui is often the way to go when you can't understand the root cause of your problem. 

::: {.callout-note appearance="simple"}
### Make a Reprex!
One more approach to consider is to try to isolate your problem. 
:::

Sometimes it can be hard to build a mental picture of all the moving elements under the hood in your server, and how they may be unexpectedly interacting with each other. The problem you're encountering may be due to these complex interactions in your server. Simply commenting out the code not directly related to the issue you are experiencing helps to triangulate the source of the issue within your reactive model. This is also the first step towards producing a [reprex](https://community.rstudio.com/t/faq-whats-a-reproducible-example-reprex-and-how-do-i-create-one/5219) - a reproducible example. These should be as minimal as possible and are very helpful to start getting to the root of a programming problem.

### Specifying Working Directory.

This is more of a consideration for deployment to a service such as shinyapps.io than something you tend to encounter while learning the ropes. And you likely won't encounter this issue if your `app.py` file is located in the top level of your project folder (also known as the project root). If your app is not in the root of the project folder, you may wish to include this snippet of code before you define your Shiny ui:

`os.chdir(os.path.dirname(os.path.realpath(__file__)))`

This ensures that the working directory is set to that of the `app.py` file when it runs. If you encounter pandas errors complaining about `FileExistsError` when you deploy your app to shinyapps.io but not when you locally run your application, this may be the fix you need. Also something to consider if your app is styled correctly locally but not when you deploy. Potentially a relative path to a dedicated stylesheet has broken. 

One more thing on deploying your app - if you do intend to host your app for others to use, I cannot emphasise this enough:

::: {.callout-note appearance="simple"}
### Deploy Your App Early!
:::

Deployment of applications is not a straight forward, half an hour job. There
are often inconsistencies to iron out between the environment you developed the
app in and the server that will be running the remote app for your users. Deploy
your app early when it is basic and you can catch these inconsistencies as you
go. Or don't and ignore the pile of technical debt your project is accruing.
These are your choices. 

## In Review.

We have written a very basic application that is not much use beyond a basic
tutorial. Although we have successfully demonstrated how to have the `ui` and
`server` elements of a Shiny application talk to one another. We've captured
dynamic inputs provided by the user and presented them back within the
interface. And we have been able to pause the server execution until the user
asks for a response. That's not a bad start at all. But so much more than this
can be achieved in Python Shiny. A good place to go for inspiration is the
[Posit Example Gallery](https://shinylive.io/py/examples/). And if you'd like to
understand a little more about how Python Shiny fits into the Python
dashboarding toolkit, please check out my other blog on [The Current State of Python Shiny](01-state-of-pyshiny.html).

Happy dashboarding!
